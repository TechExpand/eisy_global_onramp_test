{"version":3,"sources":["../src/loader.ts"],"sourcesContent":["import type { MoonPayWebSdkInitFn, WindowMoonPayWebSdk } from '@web-sdk';\n\ndeclare const window: Window & WindowMoonPayWebSdk;\n\nconst scriptLoadingStatus = {\n  isLoading: false,\n  isLoaded: false,\n  startTime: 0,\n};\n\nexport async function loadMoonPay(\n  version: string | null = 'v1',\n): Promise<MoonPayWebSdkInitFn | undefined> {\n  return new Promise((resolve, reject) => {\n    const scriptSrc = `https://static.moonpay.com/web-sdk/${version}/moonpay-web-sdk.min.js`;\n    const existingScript = document.querySelector(`script[src=\"${scriptSrc}\"]`);\n\n    if (existingScript) {\n      if (scriptLoadingStatus.isLoaded) {\n        resolve(window.MoonPayWebSdk?.init);\n      } else if (scriptLoadingStatus.isLoading) {\n        const elapsedTime = Date.now() - scriptLoadingStatus.startTime;\n        if (elapsedTime > 10000) {\n          reject(new Error('Loading MoonPayWebSdk script timed out.'));\n        } else {\n          setTimeout(() => resolve(loadMoonPay(version)), 100);\n        }\n      }\n      return;\n    }\n\n    scriptLoadingStatus.isLoading = true;\n    scriptLoadingStatus.startTime = Date.now();\n\n    const script = document.createElement('script');\n    script.async = true;\n    script.src = scriptSrc;\n\n    script.addEventListener('load', () => {\n      scriptLoadingStatus.isLoading = false;\n      scriptLoadingStatus.isLoaded = true;\n\n      resolve(window.MoonPayWebSdk?.init);\n    });\n\n    script.addEventListener('error', () => {\n      scriptLoadingStatus.isLoading = false;\n      scriptLoadingStatus.isLoaded = false;\n\n      reject(new Error('Failed to load MoonPayWebSdk script.'));\n    });\n\n    document.body.appendChild(script);\n  });\n}\n"],"mappings":";AAIA,IAAM,sBAAsB;AAAA,EAC1B,WAAW;AAAA,EACX,UAAU;AAAA,EACV,WAAW;AACb;AAEA,eAAsB,YACpB,UAAyB,MACiB;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,YAAY,sCAAsC,OAAO;AAC/D,UAAM,iBAAiB,SAAS,cAAc,eAAe,SAAS,IAAI;AAE1E,QAAI,gBAAgB;AAClB,UAAI,oBAAoB,UAAU;AAChC,gBAAQ,OAAO,eAAe,IAAI;AAAA,MACpC,WAAW,oBAAoB,WAAW;AACxC,cAAM,cAAc,KAAK,IAAI,IAAI,oBAAoB;AACrD,YAAI,cAAc,KAAO;AACvB,iBAAO,IAAI,MAAM,yCAAyC,CAAC;AAAA,QAC7D,OAAO;AACL,qBAAW,MAAM,QAAQ,YAAY,OAAO,CAAC,GAAG,GAAG;AAAA,QACrD;AAAA,MACF;AACA;AAAA,IACF;AAEA,wBAAoB,YAAY;AAChC,wBAAoB,YAAY,KAAK,IAAI;AAEzC,UAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,WAAO,QAAQ;AACf,WAAO,MAAM;AAEb,WAAO,iBAAiB,QAAQ,MAAM;AACpC,0BAAoB,YAAY;AAChC,0BAAoB,WAAW;AAE/B,cAAQ,OAAO,eAAe,IAAI;AAAA,IACpC,CAAC;AAED,WAAO,iBAAiB,SAAS,MAAM;AACrC,0BAAoB,YAAY;AAChC,0BAAoB,WAAW;AAE/B,aAAO,IAAI,MAAM,sCAAsC,CAAC;AAAA,IAC1D,CAAC;AAED,aAAS,KAAK,YAAY,MAAM;AAAA,EAClC,CAAC;AACH;","names":[]}